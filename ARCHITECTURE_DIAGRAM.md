# ğŸ—ï¸ Architecture - Affichage Dynamique des Documents de Chapitre

## ğŸ“ Vue d'Ensemble

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    /deep-course/:deepcourseId/:chapterId         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              DocumentTitleProvider                        â”‚   â”‚
â”‚  â”‚  (contexte pour le titre du document)                     â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚          DeepCoursesLayout                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   DeepCourseHeader                         â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   - Back Button / Action Button             â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   DeepCourseTabs                           â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   [cours] [exercice] [evaluation]           â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   (activeTab = "cours" | "exercice" | ...)  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   DeepCourseMainContent                     â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   (depth === 3)                             â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚                   â”‚                  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ 70% Content       â”‚ 30% Copilote    â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚                   â”‚                  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”‚ContentContainerâ”‚ â”‚                  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”‚               â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚  Copilote    â”‚ â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”‚ â”‚ Chapter   â”‚ â”‚ â”‚ â”‚  Container   â”‚ â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”‚ â”‚ Document  â”‚ â”‚ â”‚ â”‚  (chat)      â”‚ â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”‚ â”‚ Container â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚                  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â”‚               â”‚ â”‚                  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚                   â”‚                  â”‚  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ChapterDocumentContainer - DÃ©tail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ChapterDocumentContainer                             â”‚
â”‚        (src/layouts/ChapterDocumentContainer.tsx)           â”‚
â”‚                                                              â”‚
â”‚  EntrÃ©es:                                                    â”‚
â”‚  - chapterId: string (du contexte)                          â”‚
â”‚  - activeTab: "cours"|"exercice"|"evaluation" (contexte)    â”‚
â”‚  - userId: string (session)                                 â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ã‰tape 1: RÃ©cupÃ©rer les IDs des documents               â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ const { data: chapterDocs } =                          â”‚ â”‚
â”‚  â”‚   useChapterDocuments(chapterId)                       â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ API: POST /fetchchapterdocument                        â”‚ â”‚
â”‚  â”‚ Response: {                                            â”‚ â”‚
â”‚  â”‚   chapter_id: "chapter-1",                            â”‚ â”‚
â”‚  â”‚   course_session_id: "session-111",                   â”‚ â”‚
â”‚  â”‚   exercice_session_id: "session-222",                 â”‚ â”‚
â”‚  â”‚   evaluation_session_id: "session-333"                â”‚ â”‚
â”‚  â”‚ }                                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ã‰tape 2: Mapper activeTab â†’ sessionId                 â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ activeTab = "cours"                                   â”‚ â”‚
â”‚  â”‚ â†“                                                      â”‚ â”‚
â”‚  â”‚ sessionId = chapterDocs.course_session_id             â”‚ â”‚
â”‚  â”‚ â†“                                                      â”‚ â”‚
â”‚  â”‚ sessionId = "session-111"                             â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ (Idem pour "exercice" et "evaluation")               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ã‰tape 3: Mapper activeTab â†’ docType                  â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ "cours" â†’ "course"                                    â”‚ â”‚
â”‚  â”‚ "exercice" â†’ "exercise"                               â”‚ â”‚
â”‚  â”‚ "evaluation" â†’ "exercise"                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ã‰tape 4: RÃ©cupÃ©rer le document complet                â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ const { data } = useSessionCache(                     â”‚ â”‚
â”‚  â”‚   sessionId,           // "session-111"              â”‚ â”‚
â”‚  â”‚   docType,             // "course"                   â”‚ â”‚
â”‚  â”‚   userId               // "user-123"                 â”‚ â”‚
â”‚  â”‚ )                                                      â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ API: POST /fetchdocument                              â”‚ â”‚
â”‚  â”‚ Response: {                                            â”‚ â”‚
â”‚  â”‚   document: CourseOutput { ... }                      â”‚ â”‚
â”‚  â”‚   documentType: "course"                              â”‚ â”‚
â”‚  â”‚   messages: []                                         â”‚ â”‚
â”‚  â”‚ }                                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ã‰tape 5: Afficher le bon composant                    â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ if (isExerciseOutput(document))                        â”‚ â”‚
â”‚  â”‚   return <ExerciseViewer exercise={document} />       â”‚ â”‚
â”‚  â”‚ else if (isCourseOutput(document))                    â”‚ â”‚
â”‚  â”‚   return <CourseViewer course={document} />           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†“                                   â”‚
â”‚                      RENDERING                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Changement d'Onglet

```
Utilisateur clique sur "exercice"
     â†“
DeepCourseTabs dÃ©tecte le click
     â†“
setActiveTab("exercice")
     â†“
Contexte DeepCoursesLayoutContext se met Ã  jour
     â†“
ChapterDocumentContainer dÃ©tecte le changement (dÃ©pendance: activeTab)
     â†“
Re-render avec activeTab = "exercice"
     â†“
sessionId change: "session-111" â†’ "session-222"
docType change: "course" â†’ "exercise"
     â†“
useSessionCache dÃ©tecte le changement (dÃ©pendance: sessionId, docType)
     â†“
Nouvelle requÃªte: POST /fetchdocument (session_id: "session-222")
     â†“
ExerciseViewer se rend avec le nouvel exercice
```

## ğŸ”€ DÃ©duplication & Caching

```
ScÃ©nario: Deux onglets "cours" ouverts en parallÃ¨le

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RequÃªte 1: useSessionCache                  â”‚
â”‚ - sessionId: "session-111"                  â”‚
â”‚ - queryKey: ["sessionCache", "session-111"] â”‚
â”‚ - Ã‰tat: FETCHING                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
             (50ms plus tard)
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RequÃªte 2: useSessionCache                  â”‚
â”‚ - sessionId: "session-111"                  â”‚
â”‚ - queryKey: ["sessionCache", "session-111"] â”‚
â”‚ - Ã‰tat: DEDUPLICATED (attend la premiÃ¨re)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
         (Une seule requÃªte HTTP)
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Les deux reÃ§oivent la mÃªme rÃ©ponse          â”‚
â”‚ Aucun doublon rÃ©seau!                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§  Gestion d'Ã‰tat

```
                     DeepCoursesLayoutContext
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         â”‚         â”‚
              depth: 3   chapterId   activeTab
                    â”‚         â”‚         â”‚
                    â†“         â†“         â†“
            ChapterDocumentContainer
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“           â†“           â†“
    chapterDocs  sessionId   docType
        â”‚           â”‚           â”‚
        â†“           â†“           â†“
    useChapterDocuments  useSessionCache
        â”‚                       â”‚
        â†“                       â†“
    document (CourseOutput || ExerciseOutput)
        â”‚
        â†“
    CourseViewer || ExerciseViewer
```

## ğŸ“Š React Query Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              React Query Configuration                  â”‚
â”‚              (from QueryProvider.tsx)                    â”‚
â”‚                                                          â”‚
â”‚  staleTime: 0            â†’ DonnÃ©es toujours obsolÃ¨tes   â”‚
â”‚  gcTime: 30s             â†’ Cache pendant 30s            â”‚
â”‚  refetchOnMount: true    â†’ Refetch au montage           â”‚
â”‚  refetchOnWindowFocus    â†’ Refetch au focus             â”‚
â”‚  refetchOnReconnect      â†’ Refetch Ã  la reconnexion     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                                 â†“
useChapterDocuments              useSessionCache
  - queryKey:                      - queryKey:
    ["chapterDocuments",             ["sessionCache",
     chapterId]                       sessionId,
                                     docType,
  - staleTime: 0                      userId]
  - gcTime: 30s                    
                                    - staleTime: 0
  - Appel: POST                     - gcTime: 30s
    /fetchchapterdocument
                                    - Appel: POST
  - RÃ©ponse: IDs                      /fetchdocument
                                    
                                    - RÃ©ponse: Document
```

## ğŸ”— DonnÃ©es Types

```
ChapterDocuments
â”œâ”€ chapter_id: "chapter-1"
â”œâ”€ course_session_id: "session-111"
â”œâ”€ exercice_session_id: "session-222"
â””â”€ evaluation_session_id: "session-333"
    â”‚
    â”œâ”€â†’ POST /fetchdocument (session-111, type: course)
    â”‚       â†“
    â”‚   CourseOutput
    â”‚   â”œâ”€ id: "session-111"
    â”‚   â”œâ”€ title: "Introduction"
    â”‚   â”œâ”€ chapters: [{ title: "...", content: "..." }]
    â”‚   â””â”€ ...
    â”‚
    â”œâ”€â†’ POST /fetchdocument (session-222, type: exercise)
    â”‚       â†“
    â”‚   ExerciseOutput
    â”‚   â”œâ”€ id: "session-222"
    â”‚   â”œâ”€ title: "Exercice Pratique"
    â”‚   â”œâ”€ sections: [{ ... }]
    â”‚   â””â”€ ...
    â”‚
    â””â”€â†’ POST /fetchdocument (session-333, type: exercise)
            â†“
        ExerciseOutput (Ã‰valuation)
        â”œâ”€ id: "session-333"
        â”œâ”€ title: "Ã‰valuation"
        â””â”€ ...
```

## âœ… Checklist IntÃ©gration

- [x] API endpoint dÃ©fini (`/fetchchapterdocument`)
- [x] Fonction `fetchChapterDocuments` crÃ©Ã©e
- [x] Server function `getChapterDocuments` crÃ©Ã©e
- [x] Hook `useChapterDocuments` crÃ©Ã©e
- [x] Composant `ChapterDocumentContainer` crÃ©Ã©e
- [x] IntÃ©gration avec `DeepCourseMainContent`
- [x] Provider `DocumentTitleProvider` ajoutÃ©
- [x] Contextes correctement imbriquÃ©s
- [x] Error handling complÃ¨te
- [x] Loading states complÃ¨te
- [x] TypeScript validation complÃ¨te
- [x] Zod validation complÃ¨te
- [x] Fresh data strategy appliquÃ©e
- [x] DÃ©duplication configurÃ©e
- [x] Tests sans erreur

---

**LÃ©gende:**
- `â”Œâ”€â”` = Composant
- `â”‚ â”‚` = Contenu
- `â†’` = Appel API
- `â†“` = Flux de donnÃ©es
- `[ ]` = Choix/Condition
